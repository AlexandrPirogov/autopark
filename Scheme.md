# Схема

## Архитектура

![alt text](https://github.com/AlexandrPirogov/autopark/blob/docs/scheme.png)

# Сценарии 

## General

## Аутентификация

Любой пользователь отправляет запрос на аутентификацию, прикрепляя свои логин и пароль. Запрос отправляется в `api-gateway` и далее направляется в `auth-service` для проверки переданных кредов.
Если креды были обнаружены в БД, то формируется RefreshToken, который возвращается пользователю.

Последующие запросы к иным сервисам также проходят через `api-gateway` и направляются в `auth-service`,
где проверяется RefreshToken. Если он валиден, то запрос отправляется дальше к сервисам, иначе возвращается `401`.

# Админ

Все действия описываются с учетом, что пользователь был авторизован

### Регистрация менеджера для предприятия

Перед тем, как регистрировать менеджера предприятию, админ должен выбрать предприятие. Для идентификации предприятия используются `id`. API: `/{id}/register/manager`.
Выбрал для нового менеджера логин и пароль запрос направляется в `auth-service`, где  новый менеджер записывается в БД. 
После сохранения нового менеджера, `auth-service` возвращает идентификатор `id` зарегестрированного менеджера сервису `enterprise-service`, который связывает этого менеджра с выбранным предприятием.

*Учитывайте, что между сервисами должны иметь валидный RefreshToken*

Вспоследствии, менеджер под логином и паролем сможет обращаться к сервису `manager-service`.

# Manager


